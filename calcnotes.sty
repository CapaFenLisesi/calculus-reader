\ProvidesPackage{calcnotes}

%% LOAD PACKAGES

% Load AMS-LaTeX packages for math typesetting
\usepackage{amsfonts,amssymb,amsthm}
\usepackage{mathtools}

% Load COntent-Oriented LaTeX for semantic math
\usepackage{cool}

% Load SIUnitX for units handling
\usepackage[per-mode=symbol]{siunitx}

% Load xfrac for nice fractions
\usepackage{xfrac}

% Set up font handling
\usepackage[T1]{fontenc}
\usepackage{microtype}

% Use subfiles for chapter includes
\usepackage{subfiles}

% Use the Libertine font with math extensions
\usepackage{libertine}
\usepackage[libertine]{newtxmath}

% Use the Inconsolata font for monospace
\usepackage{inconsolata}

% Use the "Dutch calligraphic" alphabet from mathalfa
\usepackage[cal=dutchcal]{mathalfa}

% Load the csquotes package for semantic quotation marks
\usepackage{csquotes}

% Load the TikZ package for figures and diagrams
\usepackage{tikz}
\usepackage{pgfplots}

% Load the float package for fine-grained control over float placement
\usepackage{float}

% Load the fullwidth package for figures that span the margin
\usepackage{fullwidth}

% Load the booktabs package for professional-looking tables
\usepackage{booktabs}

% Load the listings package for code listings
\usepackage{listings}

% Load the exsheets package for exercises with later solutions
\let\vary\undefined % NewTXMath also defines a \vary command that we don't need but which causes errors
\usepackage{exsheets}

% Load the hyperref package for hyperlinking (MUST BE LAST)
\usepackage{hyperref}

% Load the cleveref package for intelligent cross-referencing (MUST BE AFTER HYPERREF)
\usepackage[capitalize]{cleveref}

%% SET OPTIONS

% Configure listings
\lstset{
  basicstyle=\footnotesize\ttfamily,
  commentstyle=\color{gray},
  numbers=left,
  breaklines=true,
  breakatwhitespace=true,
  numberstyle=\footnotesize,
  stepnumber=2,
  showstringspaces=false,
}

% Configure PGFPlots
\pgfplotsset{ % Define a common style, so we don't repeat ourselves
  rectify/.style={
    axis equal image, % Unit vectors of equal lengths in both directions
  },
  agdplot/.style={
    width = \linewidth,
    axis lines = middle, % Put axes at x=0, y=0
    axis line style = {-latex}, % Use LaTeX arrowheads
    smooth, % Smooth all curves
    samples = 100, % A decent default for most curves
    area style, % Fill regions bounded by \closedcycle
    scale only axis, % Fit axes to size rather than fiddling with labels
  },
  box1/.style={
    draw=blue,
    fill=blue!10,
  },
  box2/.style={
    draw=red,
    fill=red!10,
  },
  box3/.style={
    draw=green,
    fill=green!10,
  },
  % from http://tex.stackexchange.com/a/30782
  integral segments/.code={\pgfmathsetmacro\integralsegments{#1}},
  leftriemann/.style args={#1:#2}{
    ybar interval,
    domain=#1:#2,
    samples=\integralsegments+1,
    x filter/.code=\pgfmathparse{\pgfmathresult)}
  },
  rightriemann/.style args={#1:#2}{
    ybar interval,
    domain=#1+((#2-#1)/\integralsegments):#2+((#2-#1)/\integralsegments),
    samples=\integralsegments+1,
    x filter/.code=\pgfmathparse{\pgfmathresult-((#2-#1)/\integralsegments)}
  },
  midriemann/.style args={#1:#2}{
    ybar interval,
    domain=#1+((#2-#1)/\integralsegments)/2:#2+((#2-#1)/\integralsegments)/2,
    samples=\integralsegments+1,
    x filter/.code=\pgfmathparse{\pgfmathresult-((#2-#1)/\integralsegments)/2}
  },
  trapezoid/.style args={#1:#2}{
    samples = \integralsegments+1,
    domain = #1:#2,
  },
  trapezoid divisions/.style args={#1:#2}{
    trapezoid = #1:#2,
    ycomb,
  },
  trapezoid interiors/.style args={#1:#2}{
    trapezoid = #1:#2,
    sharp plot,
  },
}


% Configure cleveref
\crefname{lstlisting}{listing}{listings}
\Crefname{lstlisting}{Listing}{Listings}
\crefname{equation}{equation}{equations}

% Configure theorem styles
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{observation}[theorem]{Observation}

\newtheorem*{theorem*}{Theorem}
\newtheorem*{corollary*}{Corollary}
\newtheorem*{lemma*}{lemma}
\newtheorem*{proposition*}{Proposition}
\newtheorem*{observation*}{Observation}

\newtheorem*{motprob}{Problem}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem*{definition*}{Definition}

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}
\newtheorem*{remark*}{Remark}

\newtheorem{example}[theorem]{Example}
\newtheorem*{example*}{Example}

\newtheorem*{motex}{Motivating example}

\newtheorem{note}[theorem]{Note}
\newtheorem*{note*}{Note}

\newtheorem*{soln}{Solution}

% Use roman d for differentiation and integration
\Style{DSymb={\mathrm d},DShorten=true,IntegrateDifferentialDSymb=\mathrm{d}}

% Define command for writing differentials
\newcommand*{\diff}[1]{\ensuremath{\COOL@notation@IntegrateDifferentialDSymb #1}}

% Define command for antidifferentiation
\newcommand*{\AD}[2]{\ensuremath{\frac{\COOL@notation@DSymb^{-1} {#1}}{\COOL@notation@DSymb {#2}^{-1}}}}

% Use fancy paired delimiters
\DeclarePairedDelimiter{\pbrac}{(}{)}
\DeclarePairedDelimiter{\sbrac}{[}{]}
\DeclarePairedDelimiter{\cbrac}{\{}{\}}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\DeclarePairedDelimiter{\norm}{\lVert}{\rVert}

\DeclarePairedDelimiter{\closedint}{[}{]}
\DeclarePairedDelimiter{\openint}{(}{)}

% Add some imperial units
\DeclareSIUnit{\foot}{ft}
\DeclareSIUnit{\inch}{in}
\DeclareSIUnit{\mile}{mi}
\DeclareSIUnit{\gallon}{gal}

% Commands for names of important fields
\newcommand*{\fieldname}[1]{\ensuremath{\mathbf{#1}}}
\newcommand*{\RR}{\fieldname{R}}
\newcommand*{\QQ}{\fieldname{Q}}
\newcommand*{\CC}{\fieldname{C}}

% Area function from integral calculus
\newcommand*{\areafunc}[3]{\ensuremath{A_{{#1},{#2}} \pbrac*{#3}}}

% Environment to switch section to exercise mode
\newenvironment*{exercises}{
  \subsection*{Exercises}
}{
  %
}

%% CONFIGURE LAYOUT

% Set up title page
\setlength{\droptitle}{1in}

\newcommand{\subtitle}[1]{\gdef\thesubtitle{#1}}

\definecolor{titlecolor}{gray}{0} % Black title
\newcommand{\titlefont}{\color{titlecolor}\fontsize{3cm}{0cm}\sffamily\bfseries} % Printed in giant bold sans-serif

\definecolor{subtitlecolor}{gray}{0.5} % Gray subtitle
\newcommand{\subtitlefont}{\color{subtitlecolor}\fontsize{3cm}{0cm}\sffamily\itshape} % Printed in giant italic sans-serif
\newcommand{\authorfont}{\fontsize{1cm}{0cm}\sffamily}

\renewcommand{\maketitle}{
  \thispagestyle{empty}
  \vspace*{\stretch{1}}
  \begin{flushright}
    {\titlefont\thetitle}\\[\baselineskip]
    {\subtitlefont\thesubtitle}
  \end{flushright}
  \vspace*{\stretch{2}}
  \begin{flushright}
    {\authorfont\theauthor}
  \end{flushright}
  \vspace*{\stretch{4}}
  \cleardoublepage
}

% Next, we define the part style
\aliaspagestyle{part}{empty} % No page numbers on part pages

\definecolor{partnumbercolor}{gray}{0.9} % Light gray part number
\renewcommand{\partnumfont}{\fontsize{8cm}{0cm}\bfseries} % Printed in giant bold serif face (because Biolinum I looks silly)

\definecolor{parttitlecolor}{gray}{0} % Black part name
\renewcommand{\parttitlefont}{\fontsize{1.5cm}{0cm}\bfseries\sffamily} % Printed in large bold sans-serif

\renewcommand{\printpartname}{} % Suppress internal part printing
\renewcommand{\printpartnum}{} % Suppress internal number printing
%\setlength{\midpartskip}{0pt} % Suppress space before printout

\renewcommand{\printparttitle}[1]{%
  \begin{tikzpicture}%
    \draw[color=partnumbercolor] (0, 0) node { \partnumfont \thepart };%
    \draw[color=parttitlecolor] (0, 0) node { \parttitlefont #1 };%
  \end{tikzpicture}%
}

% Next, we configure the chapter style
\makechapterstyle{calcnotes}{
  \renewcommand*{\chapterheadstart}{} % Don't do anything (like vertical space) before printing chapter heading

  \definecolor{chaptertitlecolor}{gray}{0} % Black chapter title
  \renewcommand*{\chaptitlefont}{\fontsize{1cm}{0cm}\bfseries\sffamily} % Printed in large bold sans-serif

  \definecolor{chapternumbercolor}{gray}{0.8} % Light gray chapter number
  \renewcommand*{\chapnumfont}{\fontsize{4cm}{0cm}\bfseries\sffamily} % Printed in huge bold sans-serif

  \renewcommand*{\printchaptername}{} % Suppress internal chapter name printing
  \renewcommand*{\printchapternum}{} % Suppress internal number printing
  \renewcommand*{\printchaptertitle}[1]{%
    \raggedleft
    \begin{tikzpicture}%
      \ifm@m@And
      \draw[color=chapternumbercolor] (0, 0) node { \chapnumfont \thechapter };
      \fi
      \draw[color=chaptertitlecolor] (1.5cm, 0) node[left] { \chaptitlefont ##1};
    \end{tikzpicture}
  }

  \renewcommand*{\afterchapternum}{}
}

\chapterstyle{calcnotes}

% Next, we configure section headings
\newcommand*{\seccommon}{\bfseries\sffamily}
\renewcommand{\secheadstyle}{\huge\seccommon}
\renewcommand{\subsecheadstyle}{\Large\seccommon}
\renewcommand{\subsubsecheadstyle}{\large\seccommon}
\renewcommand{\paraheadstyle}{\normalsize\seccommon}
\renewcommand{\subparaheadstyle}{\normalsize\seccommon}

% Next, we configure the page style
\pagestyle{companion}

% Memoir only numbers down to sections by default. We need to go deeper.
\setsecnumdepth{subsubsection}

% Add some space to the outer margin for marginalia
\addtolength{\textwidth}{-.1\textwidth}
\addtolength{\foremargin}{.1\textwidth}
\setlength{\marginparsep}{2eM}
\checkandfixthelayout

\newlength{\marginwidth}
\setlength{\marginwidth}{\marginparsep+\marginparwidth}

\newlength{\blockwidth}
\setlength{\blockwidth}{\marginwidth+\textwidth}

% Use small font for captions
\captionnamefont{\tiny}
\captiontitlefont{\tiny}

% Configure an environment for full-block figures
\newenvironment*{widefig}[1][htbp]{
  \begin{figure}[{#1}]
    \centering
    \begin{fullwidth}[width=\blockwidth,outermargin=-\marginwidth]
    }{
    \end{fullwidth}
  \end{figure}
}

\newenvironment*{medfig}[1][hbtp]{
  \begin{figure}[{#1}]
    \centering
  }{
  \end{figure}
}

\newenvironment*{smallfig}{
  \begin{marginfigure}
    \centering
  }{
  \end{marginfigure}
}

% Configure exsheets package
\SetupExSheets{
  % question numbering: »chapter.question«
  % use `ch.se.qu' for »chapter.section.question«
  counter-format = ch.se.qu,
  counter-within = chapter,
  headings = runin-nr,
  use-ref = true,
}
% Adjust the heading so there's are gap between heading and
% the previous paragraph a littler larger than the default:
\DeclareInstance{exsheets-heading}{runin-nr}{default}{
  runin = true ,
  number-post-code = \space ,
  join = { main[r,vc]number[l,vc](0pt,0pt) },
}

% Let memoir set up subfigure stuff
\newsubfloat{figure}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "book/calcnotes.tex"
%%% End: